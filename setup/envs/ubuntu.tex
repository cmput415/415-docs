\documentclass[../setup.tex]{subfiles}

\begin{document}

\subsection{Installing OpenJDK JRE 8}
The Java runtime environment (JRE) is required to run the ANTLR generator. OpenJDK's JRE is easier
to install than Oracle's, so we'll use that.
\begin{lstlisting}
	sudo apt-get update
	sudo apt-get install openjdk-8-jre
\end{lstlisting}

\subsection{Installing Git}
Git should be installed by default in Ubuntu. If you've removed it or it is otherwise unavailable
then you can install it using this command:
\begin{lstlisting}
  sudo apt-get update
  sudo apt-get install git
\end{lstlisting}

\subsection{ANTLR 4 C++ Runtime}
This section details how to install the ANTLR 4 C++ runtime on Ubuntu assuming your default shell
is bash. If you've changed your shell from bash it's assumed that you are familiar enough with your
environment that you can modify these steps appropriately.
\begin{enumerate}
  \item
    Choose a directory to download the runtime source to. It's \emph{not necessary} to keep this
    directory around later though it may make your life easier if you need to upgrade. If you don't
    plan on keeping it then \lstinline{\$HOME/Downloads} can be a good choice. If you do plan on
    keeping it, \lstinline{/opt} can be a good choice but it can go anywhere you choose if you have
    a personal preference. You can read about how to use \lstinline{/opt}
    \href{https://askubuntu.com/a/34922/550300} {here}. We'll call this directory choice
    \lstinline{SOURCE\_PARENT}.
  \item
    Next, we need to clone the source for the runtime from GitHub.
    \begin{lstlisting}
      cd <SOURCE_PARENT>
      git clone git@github.com:antlr/antlr4.git
    \end{lstlisting}
    This should create a new folder called \lstinline{antlr4} in \lstinline{SOURCE\_PARENT}. We'll
    refer to this new directory (\lstinline{<SOURCE\_PARENT>/antlr4}) as \lstinline{SRC\_DIR}.
  \item
    We will be using ANTLR 4.7.1 so we need to change to the git tag for version 4.7.1.
    \begin{lstlisting}
      cd <SRC_DIR>
      git checkout 4.7.1
    \end{lstlisting}
  \item
    Now we need to choose a place to build the runtime. If you've decided to not keep the source
    then the build directory will be useless because it references the source. I would suggest
    creating your build directory inside the source tree (i.e. \lstinline{<SRC\_DIR>/build}) so
    it's easy to clean up. If you're planning on keeping the source then inside your source
    directory is still often a good choice, but in the directory beside the source (i.e.
    \lstinline{<SOURCE\_PARENT>/build}) is sometimes a good idea too. Again, this can go anywhere
    you choose if you have a personal preference. We'll call this directory choice
    \lstinline{BUILD\_PARENT}.
  \item
    We can make the actual build directory:
    \begin{lstlisting}
      cd <BUILD_PARENT>
      mkdir antlr4-build
    \end{lstlisting}
    We'll refer to this new directory (\lstinline{<BUILD\_PARENT>/antlr4-build}) as
    \lstinline{BUILD\_DIR}.
  \item
    We need to have an install directory prepared before building since it's referenced in the
    build step. This directory will have the headers and compiled ANTLR libraries put into it so
    you cannot delete it. Again, \lstinline{/opt} can be a good idea but any directory you choose
    for third party libs is acceptable. We'll call this directory choice
    \lstinline{INSTALL\_PARENT}.
  \item
    We can make the actual install directory:
    \begin{lstlisting}
      cd <INSTALL_PARENT>
      mkdir antlr4-install
    \end{lstlisting}
    We'll refer to this new directory (\lstinline{<INSTALL\_PARENT>/antlr4-install}) as
    \lstinline{INSTALL\_DIR}.
  \item
    Finally, we're ready to start the actual build process. Let's being by generating the CMake
    config for the runtime. We need to do this while inside the build directory. As well, we need
    to tell it that we want to install it to a certain directory.
    \begin{lstlisting}
      cd <BUILD_DIR>
      cmake <SRC_DIR>/runtime/Cpp/ -DCMAKE_INSTALL_PREFIX="<INSTALL_DIR>"
    \end{lstlisting}
  \item
    We can finally run make to build the library and install it. You can make the process
    significantly faster by running with multiple threads using the \lstinline{-j} option and
    specifying a thread count. Using the option without a count will use all cores.
    \begin{lstlisting}
      make install -j<number of threads>
    \end{lstlisting}
  \item
    Now we can add the install to your bashrc. Pick your favorite text editor and open
    \lstinline{~/.bashrc} and add the following lines to the end, substituting appropriately:
    \begin{lstlisting}
      # C415 ANTLR install
      export ANTLR_INS=<INSTALL_DIR>
    \end{lstlisting}
  \item
    If you want to clean up then you can remove the source and build directories. Just remember,
    you may have to download them and set up again if we update later (though it's unlikely).
    \begin{lstlisting}
      rm -rf <SRC_DIR> <BUILD_DIR>
    \end{lstlisting}
\end{enumerate}

\subsection{Installing CLion}
\begin{enumerate}
	\item
    Go to the \href{https://www.jetbrains.com/clion/download/\#section=linux} {download page} and
    download \textit{CLion} for Linux.
	\item
    Assuming you've downloaded the tarball to your \lstinline{~/Downloads} folder, you can extract
    it to \lstinline{/opt/} using the following command:
  	\begin{lstlisting}
  		tar -xzf CLion-<version>.tar.gz -C /opt/
  	\end{lstlisting}
  	\textit{(If you are confident about your ability to setup your own install you can put it
    elsewhere but you will be on your own.)}
	\item
    Execute the installer:
  	\begin{lstlisting}
  		/opt/CLion-<version>/bin/CLion.sh
  	\end{lstlisting}
	\item
    Follow the installation wizard.
  	\begin{enumerate}
  		\item
        Select ``Do not import settings'' and hit \texttt{OK}.
  		\item
        Pick your favorite UI. Then hit \texttt{Next: Default Plugins}
  		\item
        You might consider disabling all but the git plugin, and even then, using it is up to you.
        It can be useful to see the color coded files for differences at a glance or track changes
        in a file. You should consider disabling all of the web development plugins. Disabling
        other tools is up to you as well. Now select \texttt{Next: Feature Plugins}
  		\item
        Again, the choices here are yours if you like vim, then maybe the vim plugin is up your
        alley. The markdown plugin can be useful as well. You do not need the TeamCity Integration.
        Select \texttt{Start using CLion}
  	\end{enumerate}
\end{enumerate}

\subsection{Installing the ANTLR Plugin for CLion}
ANTLR has a CLion integration that gives syntax highlighting as well as tool for visualising the
parse tree for a grammar rule and an input.
\begin{enumerate}
	\item
    Launch CLion by going to the application launcher (tap the super/Windows button) and typing
    \lstinline{clion}. This should launch CLion.
	\item
    Open the settings window \texttt{File $\rightarrow$ Settings...}
  \item
    Select \texttt{Plugins} from the menu on the left.
	\item
    Click \texttt{Browse Repositories} below the plugin list.
  \item
    In the new window, type \texttt{antlr} into the search bar at the top.
	\item
    From the list select \lstinline{ANTLR v4 grammar plugin}
  \item
    Click \texttt{Install} in the right pane.
	\item
    After the install bar ends click the \texttt{Restart CLion} button that should have replaced
    the \texttt{Install} button.
\end{enumerate}

	\subsection{Getting Antlr4 libraries}
		\begin{enumerate}
			\item Follow the steps on this
			\href{https://github.com/antlr/antlr4/blob/master/doc/getting-started.md}{tutorial}
			\item Follow the steps on this
			\href
			{https://github.com/antlr/stringtemplate4/blob/master/doc/java.md}
			{tutorial}
		\end{enumerate}



	\subsection{Configuring first project}
		\begin{enumerate}
			\item Click \texttt{Create new project}

			\item Select Java Project and then next to \textit{Project SDK} select \texttt{New} $\rightarrow$ \texttt{JDK}

			\item The location should be
			\begin{lstlisting}
				/usr/lib/jvm/java-8-oracle/
			\end{lstlisting}

			\item Click \texttt{Next} then click \texttt{Next} again.

			\item Name your project and click \texttt{Finish}

			\item Open Project manager (Default hotkey Alt-1)

			\item In the project menu that you just opened right-click on the \texttt{src} folder $\rightarrow$ New $\rightarrow$ File

			\item name the file
			\begin{lstlisting}
				hello.g4
			\end{lstlisting}

			\item In the new file put the following content
			\begin{lstlisting}
				grammar hello;

				rule: 'hello' id;
				id  : STRING;

				STRING: CHAR+;
				CHAR: [a-z|A-Z];
				WS: ' '+ -> skip;
			\end{lstlisting}

			\item right click on \texttt{rule} $\rightarrow$ select \texttt{Test Rule rule}

			\item There are three new boxes that open:
			\begin{enumerate}
				\item a small that appears to be to input a file name
				\item a larger one underneath
				\item To the right of that there is a box on top of which is "Parse tree | Profiler"
			\end{enumerate}
			in the second box type
			\begin{lstlisting}
				hello <your name>
			\end{lstlisting}
			in the third box a tree should appear a parse tree

			\item Congratulations you've made your first Antlr4 parser

		\end{enumerate}
\end{document}
